<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" rel="stylesheet">
	</head>
	<body>
		<div class="block">
			<p>菜单树</p>
			<el-tree :data="data"
			         :expand-on-click-node="false"
			         default-expand-all
			         highlight-current=true
			         id="menutree"
			         node-key="id"
			         show-checkbox>
				<span class="custom-tree-node" slot-scope="{ node, data }">
					<span>{{ node.label }}</span>
					<span>
						<el-button
								@click="() => append(data)"
								size="mini"
								type="text">
							<i class="el-icon-circle-plus-outline">新增</i>
						</el-button>
						<el-button
								@click="() => remove(node, data)"
								size="mini"
								type="text">
							<i class="el-icon-delete">删除</i>
						</el-button>
					</span>
				</span>
			</el-tree>
		</div>
	</body>
	<script src="https://unpkg.com/vue@2.6.10/dist/vue.js"></script>
	<script src="https://unpkg.com/element-ui/lib/index.js"></script>
	<script src="https://unpkg.com/jquery@3.4.1/dist/jquery.js"></script>
	<script type="module">
        let id = 1000;
        let parseDataTooTree = function (arg) {
            for (let i = 0; i < arg.length; i++) {
                arg[i].icon = 'el-icon-document-remove';
                arg[i].label = arg[i].name;
                if (arg[i].childList && arg[i].childList == 0) {
                    delete arg[i].childList;
                    continue;
                }
                if (arg[i].childList) {
                    parseDataTooTree(arg[i].childList);
                    arg[i].children = arg[i].childList;
                }
            }
        };
        $.get("/resource", function (arg) {
            let docu = {
                id: '11',
                name: '文档说明',
                icon: 'el-icon-document-remove',
                url: 'sa-html/sa-doc.html',
                order: 3
            };
            arg.push(docu);
            console.log(arg);
            parseDataTooTree(arg);
            let data = arg;
            let Main = {
                data() {
                    return {
                        data: JSON.parse(JSON.stringify(data)),
                    }
                },
                methods: {
                    append(data) {
                        const newChild = {id: id++, label: 'testtest', children: []};
                        if (!data.children) {
                            this.$set(data, 'children', []);
                        }
                        data.children.push(newChild);
                    },
                    remove(node, data) {
                        const parent = node.parent;
                        const children = parent.data.children || parent.data;
                        const index = children.findIndex(d => d.id === data.id);
                        children.splice(index, 1);
                    },
                }
            };
            let Ctor = Vue.extend(Main);
            new Ctor().$mount('#menutree');
        });
	</script>
	<style>
		.custom-tree-node {
			flex: 1;
			display: flex;
			align-items: center;
			justify-content: space-between;
			font-size: 14px;
			padding-right: 8px;
		}

		body, .el-tree {
			background-color: #F5F5F5;
		}

		.el-tree-node {
			margin: 0.15em 0 !important;
		}

		/* 悬浮时颜色更深一点 */
		.el-tree-node__content:hover {
			background-color: #CFE8FC !important;
		}
	</style>
</html>