<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ORM.Mapper.ResourceMapper">
    <insert id="insertByParent">
        UPDATE Resourcetable
        SET leftvalue = leftvalue + 2
        WHERE leftvalue > #{pnode.leftvalue};
        UPDATE Resourcetable
        SET rightvalue = rightvalue + 2
        WHERE rightvalue > #{pnode.leftvalue};
        UPDATE Resourcetable
        SET haschild = true
        WHERE id = #{pnode.id};
        insert into Resourcetable(name, cnname, istop, leftvalue, rightvalue, level, `order`, urlpath, haschild)
        values (#{node.name}, #{node.cnname}, #{node.istop}, #{node.leftvalue}, #{node.rightvalue}, #{node.level},
                #{node.order}, #{node.urlpath}, #{node.haschild});
    </insert>
    <delete id="deleteRes">
        DELETE
        FROM Resourcetable
        WHERE leftvalue BETWEEN #{node.leftvalue} AND #{node.rightvalue};
        UPDATE Resourcetable
        SET rightvalue = rightvalue - #{offset}
        WHERE rightvalue > #{node.rightvalue};
        UPDATE Resourcetable
        SET leftvalue = leftvalue - #{offset}
        WHERE leftvalue > #{node.rightvalue};
    </delete>
</mapper>